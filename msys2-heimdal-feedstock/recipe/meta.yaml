# This file was generated by gen-conda-repack-recipe
# using the MSYS2 package epoch: Sep 01 2024 06:00:00 UTC
#
# Any edits will be overwritten
#
# https://github.com/msys2/MSYS2-packages/blob/master/heimdal/PKGBUILD
{% set pkgname = "heimdal" %}
{% set pkgver = "7.8.0" %}
{% set pkgrel = "5" %}
{% set build_number = pkgrel|int * 1000 + 0 %}

package:
  name: repack_msys2-heimdal
  version: {{ pkgver }}

source:
  - url: https://repo.msys2.org/msys/x86_64/heimdal-{{ pkgver }}-{{ pkgrel }}-x86_64.pkg.tar.zst
    folder: msys2-heimdal
    sha256: 4b3906a2a677232d43db712b6fecab50da761c5b229c5018178a577c5c25ec64
  - url: https://repo.msys2.org/msys/x86_64/heimdal-libs-{{ pkgver }}-{{ pkgrel }}-x86_64.pkg.tar.zst
    folder: msys2-heimdal-libs
    sha256: d5f139b6feebd75f0b5fefec952c7fbb4cdfa16235601c223dabc3b1bcead19f
  - url: https://repo.msys2.org/msys/x86_64/heimdal-devel-{{ pkgver }}-{{ pkgrel }}-x86_64.pkg.tar.zst
    folder: msys2-heimdal-devel
    sha256: ae02ef2e1923a5f557a23b5e4ca593561c4b1bf4c1d272874437c0db097cb23e

build:
  number: {{ build_number }}
  binary_relocation: false
  detect_binary_files_with_prefix: false
  skip: True             # [not win]

outputs:
  - name: msys2-heimdal
    skip: True          # [not (win and x86_64)]
    script: repack.bat  # [win]
    build:
      number: {{ build_number }}
      missing_dso_whitelist:
        - $RPATH/msys-2.0.dll                                # [win]
        - $RPATH/msys-asn1-8.dll                             # [win]
        - $RPATH/msys-com_err-1.dll                          # [win]
        - $RPATH/msys-crypt-2.dll                            # [win]
        - $RPATH/msys-edit-0.dll                             # [win]
        - $RPATH/msys-gssapi-3.dll                           # [win]
        - $RPATH/msys-hcrypto-4.dll                          # [win]
        - $RPATH/msys-hdb-9.dll                              # [win]
        - $RPATH/msys-heimbase-1.dll                         # [win]
        - $RPATH/msys-heimntlm-0.dll                         # [win]
        - $RPATH/msys-hx509-5.dll                            # [win]
        - $RPATH/msys-kadm5clnt-7.dll                        # [win]
        - $RPATH/msys-kadm5srv-8.dll                         # [win]
        - $RPATH/msys-kafs-0.dll                             # [win]
        - $RPATH/msys-kdc-2.dll                              # [win]
        - $RPATH/msys-krb5-26.dll                            # [win]
        - $RPATH/msys-otp-0.dll                              # [win]
        - $RPATH/msys-roken-18.dll                           # [win]
        - $RPATH/msys-sl-0.dll                               # [win]
        - $RPATH/msys-wind-0.dll                             # [win]
    requirements:
      build:
      host:
      run:
        - msys2-msys-mutex * msys2
        - msys2-heimdal-libs                       >=7.8.0      # heimdal-libs
        - msys2-msys2-runtime                      >=3.5.4      # msys-2.0.dll
        - msys2-libxcrypt                          >=4.4.36     # msys-crypt-2.dll
        - msys2-libedit                            >=20240517_3.1 # msys-edit-0.dll
      run_constrained:
        - m2-heimdal                                <0a0
        - m2-msys2-runtime                          <0a0

    test:
      commands:
        - test -f $PREFIX/Library/etc/krb5/krb5.conf                             # [unix]
        - IF NOT EXIST %PREFIX%\Library\etc\krb5\krb5.conf EXIT /B 1             # [win]
        - afslog --help                                                          # [win and x86_64]
        - bsearch --help                                                         # [win and x86_64]
        - gsstool --help                                                         # [win and x86_64]
        - heimtools --help                                                       # [win and x86_64]
        - hxtool --help                                                          # [win and x86_64]
        - idn-lookup --help                                                      # [win and x86_64]
        - iprop-log --help                                                       # [win and x86_64]
        - kadmin --help                                                          # [win and x86_64]
        - kdestroy --help                                                        # [win and x86_64]
        - kf --help                                                              # [win and x86_64]
        - kgetcred --help                                                        # [win and x86_64]
        - kinit --help                                                           # [win and x86_64]
        - klist --help                                                           # [win and x86_64]
        - kpasswd --help                                                         # [win and x86_64]
        - kstash --help                                                          # [win and x86_64]
        - ksu --help                                                             # [win and x86_64]
        - kswitch --help                                                         # [win and x86_64]
        - ktutil --help                                                          # [win and x86_64]
        - otp --help                                                             # [win and x86_64]
        - otpprint --help                                                        # [win and x86_64]
        - pagsh --help                                                           # [win and x86_64]
        - string2key --help                                                      # [win and x86_64]
        - verify_krb5_conf --help                                                # [win and x86_64]
    about:
      home: https://www.h5l.org/
      summary: "Implementation of Kerberos V5 libraries (repack of MSYS2-packages heimdal for MSYS)"
      license: BSD-3-Clause
      license_file:
        - {{ RECIPE_DIR }}/src_licenses/LICENSE
  - name: msys2-heimdal-libs
    skip: True          # [not (win and x86_64)]
    script: repack.bat  # [win]
    build:
      number: {{ build_number }}
      missing_dso_whitelist:
        - $RPATH/msys-2.0.dll                                # [win]
        - $RPATH/msys-asn1-8.dll                             # [win]
        - $RPATH/msys-com_err-1.dll                          # [win]
        - $RPATH/msys-crypt-2.dll                            # [win]
        - $RPATH/msys-crypto-3.dll                           # [win]
        - $RPATH/msys-db-6.2.dll                             # [win]
        - $RPATH/msys-edit-0.dll                             # [win]
        - $RPATH/msys-gcc_s-seh-1.dll                        # [win]
        - $RPATH/msys-hcrypto-4.dll                          # [win]
        - $RPATH/msys-hdb-9.dll                              # [win]
        - $RPATH/msys-heimbase-1.dll                         # [win]
        - $RPATH/msys-heimntlm-0.dll                         # [win]
        - $RPATH/msys-hx509-5.dll                            # [win]
        - $RPATH/msys-krb5-26.dll                            # [win]
        - $RPATH/msys-roken-18.dll                           # [win]
        - $RPATH/msys-sqlite3-0.dll                          # [win]
        - $RPATH/msys-wind-0.dll                             # [win]
    requirements:
      build:
      host:
      run:
        - msys2-msys-mutex * msys2
        - msys2-libdb                              >=6.2.32     # libdb
        - msys2-libxcrypt                          >=4.4.36     # libxcrypt
        - msys2-libedit                            >=20240517_3.1 # libedit
        - msys2-libsqlite                          >=3.46.1     # PKGBUILD libsqlite provided by libsqlite
        - msys2-libopenssl                         >=3.3.1      # libopenssl
        - msys2-msys2-runtime                      >=3.5.4      # msys-2.0.dll
        - msys2-gcc-libs                           >=13.3.0     # msys-gcc_s-seh-1.dll
      run_constrained:
        - m2-heimdal-libs                           <0a0
        - m2-msys2-runtime                          <0a0

    test:
      commands:
        - test -f $PREFIX/Library/usr/bin/msys-asn1-8.dll                        # [unix]
        - IF NOT EXIST %PREFIX%\Library\usr\bin\msys-asn1-8.dll EXIT /B 1        # [win]
    about:
      home: https://www.h5l.org/
      summary: "Implementation of Kerberos V5 libraries (repack of MSYS2-packages heimdal-libs for MSYS)"
      license: BSD-3-Clause
      license_file:
        - {{ RECIPE_DIR }}/src_licenses/LICENSE
  - name: msys2-heimdal-devel
    skip: True          # [not (win and x86_64)]
    script: repack.bat  # [win]
    build:
      number: {{ build_number }}
    requirements:
      build:
      host:
      run:
        - msys2-msys-mutex * msys2
        - msys2-heimdal-libs                       >=7.8.0      # heimdal-libs
        - msys2-libxcrypt-devel                    >=4.4.36     # libxcrypt-devel
        - msys2-libedit-devel                      >=20240517_3.1 # libedit-devel
        - msys2-libdb-devel                        >=6.2.32     # libdb-devel
        - msys2-libsqlite-devel                    >=3.46.1     # libsqlite-devel
      run_constrained:
        - m2-heimdal-devel                          <0a0
        - m2-msys2-runtime                          <0a0

    test:
      commands:
        - test -f $PREFIX/Library/usr/bin/krb5-config                            # [unix]
        - IF NOT EXIST %PREFIX%\Library\usr\bin\krb5-config EXIT /B 1            # [win]
    about:
      home: https://www.h5l.org/
      summary: "Implementation of Kerberos V5 libraries (repack of MSYS2-packages heimdal-devel for MSYS)"
      license: BSD-3-Clause
      license_file:
        - {{ RECIPE_DIR }}/src_licenses/LICENSE
